<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../../../../styles/control/bf-base.css" />
  <link href="../../../../styles/helper.css" rel="stylesheet">
  <link href="../../../../styles/siteIcons.css" rel="stylesheet">

  <link rel="stylesheet" href="../../../../styles/control/siteIcons-control.css" />
  <link rel="stylesheet" href="../../../../styles/control/siteIcons-control.css" />
  <!-- <link rel="stylesheet" href="./style.css"> -->
  <!-- build:bundleControlBFMinJS -->
  <script src="../../../../scripts/buildfire.js"></script>
   <!-- endbuild -->
   
   <!-- build:bundleJSFiles  -->
   <script src="../../data/language.js"></script>
   <script src="../../dataAccess/language.js"></script>
   <!-- endbuild -->

  <!-- build:bundleSharedJSFiles  -->
  <script src="../../widget/js/shared/ui.js"></script>
  <script src="../../widget/js/shared/strings.js"></script>
  <script src="../../widget/js/shared/stringsConfig.js"></script>
  <!-- endbuild -->

  <!-- build:bundleStringJSFiles  -->
  <script src="./js/stringsUI.js"></script>
  <!-- endbuild  -->

</head>


<body class="slide-in" id="languageBody">
  <!--For future language use-->
  <select id="langOptions" class="hidden" onchange="loadLanguage(this.value)">
    <option value="en-us" selected>English - US</option>
    <option value="es-mx">Spanish - MX</option>
  </select>
  <!--For future language use-->
  <a class="text-success hidden" onclick="createLanguage(langOptions.value)">
    Click here to begin supporting this language</a>
  <div id="stringsContainer">loading...</div>
</body>

<script>
  let strings;
  let delay = 350;
  let timer;
  function loadLanguage(lang) {
    strings = new buildfire.services.Strings(lang, stringsConfig);
    strings.init().then(() => {
      strings.inject();
    });
    stringsUI.init("stringsContainer", strings, stringsConfig);
  }

  async function loadingAndCreateLanguage(lang) {
    loadLanguage(lang);
    createLanguage(lang);
  }

  function createLanguage(language) {
    stringsContainer.disabled = true;
    strings.createLanguage(language, () => {
      stringsContainer.disabled = false;
    });
    return false;
  }

  function deleteLanguage() {
    buildfire.notifications.confirm(
      {
        message: "Are you sure you want to remove support fo this language?",
        confirmButton: { type: "danger" },
      },
      (e, r) => {
        if (r.selectedButton.key == "confirm") {
          strings.deleteLanguage(() => {
            loadLanguage(langOptions.value);
          });
        }
      }
    );
  }

  function save() {
    strings.save((r) => {
      buildfire.messaging.sendMessageToWidget({ cmd: "refresh" });
    });
  }

  const initialState = async () => {
    await loadingAndCreateLanguage(langOptions.value);
  };

  async function checkInputs() {
    var inputs = document.getElementsByTagName("input");
    const events = ["keyup", "change"];
    for (var j = 0; j < events.length; j++) {
      for (var i = 0; i < inputs.length; i++) {
        inputs[i].addEventListener(events[j], (e) => {
          save();
        });
      }
    }

    return true;
  }
  initialState();
  checkInputs();

</script>

</html>